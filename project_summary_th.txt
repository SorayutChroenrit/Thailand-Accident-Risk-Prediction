# สรุปรายละเอียดโครงการ SafeRoute Thailand (ฉบับเจาะลึกการทำงาน)

SafeRoute Thailand คือแพลตฟอร์มเว็บไซต์อัจฉริยะที่ถูกพัฒนาขึ้นเพื่อช่วย "ทำนายและวิเคราะห์ความเสี่ยงในการเกิดอุบัติเหตุทางถนน" ในประเทศไทย โดยใช้เทคโนโลยีปัญญาประดิษฐ์ (AI) และข้อมูลสภาพจราจรแบบเรียลไทม์

เอกสารนี้จะอธิบายหลักการทำงานของแต่ละฟีเจอร์อย่างละเอียด ทั้งข้อมูลขาเข้า (Input), กระบวนการ (Process), และข้อมูลขาออก (Output)

---

## 1. หน้าแดชบอร์ดสรุปข้อมูล (Dashboard)
**หลักการทำงาน:** เป็นศูนย์กลางการแสดงผลข้อมูลสถิติอุบัติเหตุ โดยดึงข้อมูลจากฐานข้อมูลกลางที่รวบรวมไว้

### ⚙️ การทำงานเชิงเทคนิค
*   **API Endpoint:** `GET /dashboard/stats`
*   **Input (สิ่งที่ส่งไปขอข้อมูล):**
    *   `date_range`: ช่วงเวลา (เช่น 7 วัน, 30 วัน, ปีนี้)
    *   `province`: ชื่อจังหวัด (หรือ "all" เพื่อดูทั้งประเทศ)
    *   `casualty_type`: ระดับความรุนแรง (บาดเจ็บ/เสียชีวิต)
    *   `vehicle_type`: ประเภทรถ
    *   `weather`: สภาพอากาศ
*   **Process (การประมวลผล):**
    *   ระบบ Backend จะรับเงื่อนไขตัวกรอง (Filter) ต่างๆ
    *   ทำการ Query ข้อมูลจากฐานข้อมูล SQL เพื่อคำนวณผลรวมและจัดกลุ่มข้อมูล
*   **Output (สิ่งที่ได้รับกลับมา):**
    *   `summary`: ยอดรวมอุบัติเหตุ, ผู้เสียชีวิต, ผู้บาดเจ็บ
    *   `monthly_trend`: สถิติรายเดือนสำหรับวาดกราฟเส้น
    *   `severity_distribution`: สัดส่วนความรุนแรงสำหรับวาดกราฟวงกลม
    *   `top_provinces`: 10 อันดับจังหวัดที่มีอุบัติเหตุสูงสุด
    *   `hourly_pattern`: ช่วงเวลาที่เกิดเหตุบ่อยที่สุด (รายชั่วโมง)

---

## 2. ระบบทำนายความเสี่ยงด้วย AI (AI Prediction)
**หลักการทำงาน:** ใช้โมเดล Machine Learning (XGBoost) ที่ผ่านการเรียนรู้จากข้อมูลอุบัติเหตุในอดีตกว่า 50,000 เคส เพื่อประเมินความเสี่ยงในอนาคต

### ⚙️ การทำงานเชิงเทคนิค
*   **API Endpoint:** `POST /predict`
*   **Input (ข้อมูลที่ใช้ทำนาย):**
    *   **สถานที่:** พิกัด (Latitude, Longitude), ประเภทถนน
    *   **เวลา:** ชั่วโมง, วันในสัปดาห์, เดือน, วันหยุดเทศกาล
    *   **สภาพแวดล้อม:** สภาพอากาศ (ฝนตก/แดดออก), ความหนาแน่นจราจร
    *   **ยานพาหนะ:** ประเภทรถที่ขับขี่
*   **Process (การประมวลผล):**
    *   ระบบแปลงข้อมูลดิบเป็น "Features" กว่า 113 ตัวแปร (เช่น แปลงเวลาเป็น Sin/Cos เพื่อหาความเป็นวัฏจักร)
    *   ส่งเข้าโมเดล **XGBoost** เพื่อคำนวณความน่าจะเป็น
*   **Output (ผลลัพธ์):**
    *   `risk_score`: คะแนนความเสี่ยง (0-100)
    *   `risk_level`: ระดับความเสี่ยง (ต่ำ, ปานกลาง, สูง, สูงมาก)
    *   `probabilities`: โอกาสที่จะเกิดการบาดเจ็บระดับต่างๆ (เช่น เสียชีวิต 10%, บาดเจ็บเล็กน้อย 80%)
    *   `recommendations`: คำแนะนำความปลอดภัยที่เหมาะสมกับสถานการณ์นั้นๆ

---

## 3. ระบบวิเคราะห์เส้นทางปลอดภัย (Route Analysis)
**หลักการทำงาน:** ค้นหาเส้นทางจากจุด A ไปจุด B และประเมินความเสี่ยงตลอดเส้นทาง เพื่อแนะนำทางที่ปลอดภัยที่สุด

### ⚙️ การทำงานเชิงเทคนิค
*   **API Usage:** ใช้ **Longdo Map API** สำหรับการหาเส้นทาง และ **OpenWeatherMap API** สำหรับข้อมูลอากาศ
*   **Input:**
    *   จุดเริ่มต้น (Origin) และ จุดหมายปลายทาง (Destination)
    *   เวลาเดินทาง (Departure Time)
*   **Process (การประมวลผล):**
    1.  **หาเส้นทาง:** ระบบขอเส้นทางจาก Longdo Map (เส้นทางแนะนำ, สั้นที่สุด, ปลอดภัยที่สุด)
    2.  **แบ่งส่วนเส้นทาง:** ซอยเส้นทางเป็นช่วงๆ (Segments) ตามเวลาขับขี่
    3.  **ประเมินความเสี่ยง:** แต่ละช่วงจะถูกคำนวณความเสี่ยงโดยดูจาก:
        *   สภาพอากาศ ณ เวลาที่ขับผ่านจุดนั้น (พยากรณ์ล่วงหน้า)
        *   สภาพจราจร (รถติด = ความเสี่ยงสูงขึ้น)
        *   ช่วงเวลา (กลางคืน/ชั่วโมงเร่งด่วน = ความเสี่ยงสูงขึ้น)
        *   คะแนนความเสี่ยงจาก AI Model
    4.  **หาค่าเฉลี่ย:** คำนวณ `overallRisk` ของทั้งเส้นทาง
*   **Output:**
    *   รายการเส้นทางพร้อมระบุ: ระยะทาง (km), เวลา (min), ค่าความเสี่ยง (Risk Score), และค่าใช้จ่ายประมาณการ (ค่าน้ำมัน/ทางด่วน)

---

## 4. แผนที่ความเสี่ยงและเหตุการณ์สด (Live Events / Risk Map)
**หลักการทำงาน:** แสดงข้อมูลเหตุการณ์ปัจจุบันบนแผนที่ เพื่อให้ผู้ใช้หลีกเลี่ยงจุดอันตราย

### ⚙️ การทำงานเชิงเทคนิค
*   **API Endpoints:** `/traffic/density`, `/road/hazards`
*   **Input:** พิกัดแผนที่บริเวณที่ผู้ใช้กำลังดู (Viewport Lat/Lon)
*   **Process:**
    *   ระบบดึงข้อมูลสภาพจราจรและเหตุการณ์ (รถเสีย, อุบัติเหตุ, ก่อสร้าง) จากแหล่งข้อมูลภายนอก (เช่น TomTom, Longdo)
    *   นำมาแปลงเป็นหมุด (Markers) บนแผนที่
*   **Output:**
    *   รายการเหตุการณ์ (Type, Location, Severity)
    *   ดัชนีรถติด (Traffic Index) ระดับ 0-10

---

## 5. คลังข้อมูลอุบัติเหตุ (Historical Records)
**หลักการทำงาน:** ระบบสืบค้นข้อมูลย้อนหลังสำหรับดูประวัติการเกิดอุบัติเหตุ

### ⚙️ การทำงานเชิงเทคนิค
*   **Database:** เชื่อมต่อกับ **Supabase (PostgreSQL)**
*   **Process:**
    *   ดึงข้อมูลดิบจากตารางอุบัติเหตุ
    *   รองรับการค้นหา (Search) และการจัดเรียง (Sort) ตามวันที่หรือความรุนแรง
*   **Output:** รายการอุบัติเหตุพร้อมรายละเอียดทั้งหมด (สถานที่, เวลา, สาเหตุ, คู่กรณี)

---

## สรุปเทคโนโลยีที่ใช้ (Tech Stack Summary)

*   **Frontend:** React 19, TypeScript, Tailwind CSS, Leaflet Map
*   **Backend:** Python FastAPI, Pandas, NumPy
*   **AI Model:** XGBoost (Gradient Boosting Tree)
*   **Database:** Supabase (PostgreSQL)
*   **External APIs:** Longdo Map, OpenWeatherMap, TomTom Traffic

---
*เอกสารนี้จัดทำขึ้นเพื่ออธิบายรายละเอียดเชิงลึกของระบบ SafeRoute Thailand*
